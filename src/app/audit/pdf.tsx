"use client";

import React from "react";
import { jsPDF } from "jspdf";
import autoTable from 'jspdf-autotable';

interface Recommendation {
Â  text: string;
Â  priority: "High" | "Medium" | "Low";
}

interface AuditReport {
Â  seo?: number;
Â  performance?: number;
Â  accessibility?: number;
Â  bestPractices?: number;
Â  analysis?: string;
Â  recommendations?: Recommendation[];
Â  loadingTime?: number;
Â  pageSize?: number;
Â  requests?: number;
}

interface PDFProps {
Â  report: AuditReport | null;
Â  url: string;
}

const PDFGenerator: React.FC<PDFProps> = ({ report, url }) => {
Â  const handleDownloadPDF = () => {
Â  Â  if (!report) return;

Â  Â  const pdf = new jsPDF("p", "mm", "a4");
Â  Â  const pageWidth = pdf.internal.pageSize.getWidth();
Â  Â  const pageHeight = pdf.internal.pageSize.getHeight();
Â  Â  const margin = 20;
Â  Â  const contentWidth = pageWidth - margin * 2;
Â  Â  let yPosition = margin;

Â  Â  // Colors
Â  Â  const primaryColor = [15, 118, 110];
Â  Â  const secondaryColor = [20, 184, 166];
Â  Â  const successColor = [34, 197, 94];
Â  Â  const warningColor = [234, 179, 8];
Â  Â  const dangerColor = [239, 68, 68];
Â  Â  const lightColor = [248, 250, 252];
Â  Â  const darkColor = [15, 23, 42];

Â  Â  /** -------------------------------- COVER PAGE -------------------------------- **/
Â  Â  // Background gradient
Â  Â  pdf.setFillColor(15, 118, 110);
Â  Â  pdf.rect(0, 0, pageWidth, pageHeight, "F");
Â  Â  
Â  Â  // Logo/Icon
Â  Â  pdf.setFillColor(255, 255, 255, 0.1);
Â  Â  pdf.circle(pageWidth / 2, 80, 40, "F");
Â  Â  
Â  Â  pdf.setFillColor(255, 255, 255);
Â  Â  pdf.circle(pageWidth / 2, 80, 15, "F");
Â  Â  
Â  Â  // Title
Â  Â  pdf.setTextColor(255, 255, 255);
Â  Â  pdf.setFont("helvetica", "bold");
Â  Â  pdf.setFontSize(32);
Â  Â  pdf.text("SEO AUDIT REPORT", pageWidth / 2, 140, { align: "center" });

Â  Â  pdf.setFontSize(18);
Â  Â  pdf.setFont("helvetica", "normal");
Â  Â  pdf.text("Comprehensive Website Analysis", pageWidth / 2, 155, {
Â  Â  Â  align: "center",
Â  Â  });

Â  Â  // Website URL
Â  Â  pdf.setFontSize(14);
Â  Â  pdf.text(`Website: ${url}`, pageWidth / 2, 180, { align: "center" });

Â  Â  // Date
Â  Â  pdf.setFontSize(12);
Â  Â  pdf.text(
Â  Â  Â  `Generated on: ${new Date().toLocaleDateString("en-US", {
Â  Â  Â  Â  year: "numeric",
Â  Â  Â  Â  month: "long",
Â  Â  Â  Â  day: "numeric",
Â  Â  Â  Â  hour: "2-digit",
Â  Â  Â  Â  minute: "2-digit",
Â  Â  Â  })}`,
Â  Â  Â  pageWidth / 2,
Â  Â  Â  195,
Â  Â  Â  { align: "center" }
Â  Â  );

Â  Â  // Footer
Â  Â  pdf.setFontSize(10);
Â  Â  pdf.text("Generated by RankSeo.in", pageWidth / 2, pageHeight - 30, {
Â  Â  Â  align: "center",
Â  Â  });

Â  Â  pdf.addPage();

Â  Â  /** -------------------------------- EXECUTIVE SUMMARY -------------------------------- **/
Â  Â  yPosition = margin;
Â  Â  
Â  Â  // Header
Â  Â  pdf.setFillColor(...primaryColor);
Â  Â  pdf.rect(margin, yPosition, contentWidth, 12, "F");
Â  Â  pdf.setTextColor(255, 255, 255);
Â  Â  pdf.setFontSize(16);
Â  Â  pdf.setFont("helvetica", "bold");
Â  Â  pdf.text("EXECUTIVE SUMMARY", margin + 8, yPosition + 8);
Â  Â  yPosition += 20;

Â  Â  // Summary Content
Â  Â  pdf.setTextColor(...darkColor);
Â  Â  pdf.setFontSize(11);
Â  Â  pdf.setFont("helvetica", "normal");
Â  Â  
Â  Â  const summaryText = `This comprehensive audit report for ${url} provides detailed insights into your website's performance across key metrics including SEO, Performance, Accessibility, and Best Practices. The analysis identifies strengths, weaknesses, and provides actionable recommendations for improvement.`;
Â  Â  
Â  Â  const summaryLines = pdf.splitTextToSize(summaryText, contentWidth);
Â  Â  pdf.text(summaryLines, margin, yPosition);
Â  Â  yPosition += summaryLines.length * 6 + 15;

Â  Â  /** -------------------------------- SCORE OVERVIEW -------------------------------- **/
Â  Â  // Header
Â  Â  pdf.setFillColor(...primaryColor);
Â  Â  pdf.rect(margin, yPosition, contentWidth, 12, "F");
Â  Â  pdf.setTextColor(255, 255, 255);
Â  Â  pdf.setFontSize(16);
Â  Â  pdf.text("SCORE OVERVIEW", margin + 8, yPosition + 8);
Â  Â  yPosition += 20;

Â  Â  // Score Cards
Â  Â  const scores = [
Â  Â  Â  { label: "SEO", score: report.seo ?? 0, color: successColor },
Â  Â  Â  { label: "Performance", score: report.performance ?? 0, color: secondaryColor },
Â  Â  Â  { label: "Accessibility", score: report.accessibility ?? 0, color: warningColor },
Â  Â  Â  { label: "Best Practices", score: report.bestPractices ?? 0, color: primaryColor },
Â  Â  ];

Â  Â  const cardWidth = contentWidth / 2 - 5;
Â  Â  let cardX = margin;

Â  Â  scores.forEach((item, index) => {
Â  Â  Â  if (index % 2 === 0 && index !== 0) {
Â  Â  Â  Â  cardX = margin;
Â  Â  Â  Â  yPosition += 35;
Â  Â  Â  }

Â  Â  Â  // Card background
Â  Â  Â  pdf.setFillColor(...lightColor);
Â  Â  Â  pdf.roundedRect(cardX, yPosition, cardWidth, 30, 3, 3, "F");
Â  Â  Â  pdf.setDrawColor(226, 232, 240);
Â  Â  Â  pdf.roundedRect(cardX, yPosition, cardWidth, 30, 3, 3, "D");

Â  Â  Â  // Score circle
Â  Â  Â  pdf.setFillColor(...item.color);
Â  Â  Â  pdf.circle(cardX + 20, yPosition + 15, 10, "F");
Â  Â  Â  
Â  Â  Â  pdf.setTextColor(255, 255, 255);
Â  Â  Â  pdf.setFontSize(12);
Â  Â  Â  pdf.setFont("helvetica", "bold");
Â  Â  Â  pdf.text(item.score.toString(), cardX + 20, yPosition + 18, { align: "center" });

Â  Â  Â  // Label
Â  Â  Â  pdf.setTextColor(...darkColor);
Â  Â  Â  pdf.setFontSize(10);
Â  Â  Â  pdf.setFont("helvetica", "bold");
Â  Â  Â  pdf.text(item.label, cardX + 40, yPosition + 12);

Â  Â  Â  // Status
Â  Â  Â  let status = "";
Â  Â  Â  let statusColor = darkColor;
Â  Â  Â  if (item.score >= 90) {
Â  Â  Â  Â  status = "Excellent";
Â  Â  Â  Â  statusColor = successColor;
Â  Â  Â  } else if (item.score >= 70) {
Â  Â  Â  Â  status = "Good";
Â  Â  Â  Â  statusColor = secondaryColor;
Â  Â  Â  } else if (item.score >= 50) {
Â  Â  Â  Â  status = "Needs Improvement";
Â  Â  Â  Â  statusColor = warningColor;
Â  Â  Â  } else {
Â  Â  Â  Â  status = "Poor";
Â  Â  Â  Â  statusColor = dangerColor;
Â  Â  Â  }

Â  Â  Â  pdf.setTextColor(...statusColor);
Â  Â  Â  pdf.setFontSize(9);
Â  Â  Â  pdf.setFont("helvetica", "normal");
Â  Â  Â  pdf.text(status, cardX + 40, yPosition + 20);

Â  Â  Â  cardX += cardWidth + 10;
Â  Â  });

Â  Â  yPosition += 40;

Â  Â  /** -------------------------------- PERFORMANCE METRICS -------------------------------- **/
Â  Â  if (report.loadingTime || report.pageSize || report.requests) {
Â  Â  Â  pdf.setFillColor(...primaryColor);
Â  Â  Â  pdf.rect(margin, yPosition, contentWidth, 12, "F");
Â  Â  Â  pdf.setTextColor(255, 255, 255);
Â  Â  Â  pdf.setFontSize(16);
Â  Â  Â  pdf.text("PERFORMANCE METRICS", margin + 8, yPosition + 8);
Â  Â  Â  yPosition += 20;

Â  Â  Â  const metrics = [
Â  Â  Â  Â  { label: "Loading Time", value: `${report.loadingTime || 0}s`, icon: "â±ï¸" },
Â  Â  Â  Â  { label: "Page Size", value: `${report.pageSize || 0}MB`, icon: "ðŸ“Š" },
Â  Â  Â  Â  { label: "Requests", value: report.requests?.toString() || "0", icon: "ðŸ”—" },
Â  Â  Â  ];

Â  Â  Â  const metricWidth = contentWidth / 3 - 7;

Â  Â  Â  metrics.forEach((metric, index) => {
Â  Â  Â  Â  const xPos = margin + (index * (metricWidth + 10));

Â  Â  Â  Â  pdf.setFillColor(...lightColor);
Â  Â  Â  Â  pdf.roundedRect(xPos, yPosition, metricWidth, 25, 3, 3, "F");
Â  Â  Â  Â  pdf.setDrawColor(226, 232, 240);
Â  Â  Â  Â  pdf.roundedRect(xPos, yPosition, metricWidth, 25, 3, 3, "D");

Â  Â  Â  Â  pdf.setTextColor(...darkColor);
Â  Â  Â  Â  pdf.setFontSize(9);
Â  Â  Â  Â  pdf.text(metric.icon, xPos + 8, yPosition + 10);
Â  Â  Â  Â  
Â  Â  Â  Â  pdf.setFontSize(8);
Â  Â  Â  Â  pdf.text(metric.label, xPos + 20, yPosition + 10);
Â  Â  Â  Â  
Â  Â  Â  Â  pdf.setFontSize(10);
Â  Â  Â  Â  pdf.setFont("helvetica", "bold");
Â  Â  Â  Â  pdf.text(metric.value, xPos + (metricWidth / 2), yPosition + 20, { align: "center" });
Â  Â  Â  });

Â  Â  Â  yPosition += 40;
Â  Â  }

Â  Â  /** -------------------------------- SCORE CHART -------------------------------- **/
Â  Â  pdf.setFillColor(...primaryColor);
Â  Â  pdf.rect(margin, yPosition, contentWidth, 12, "F");
Â  Â  pdf.setTextColor(255, 255, 255);
Â  Â  pdf.setFontSize(16);
Â  Â  pdf.text("PERFORMANCE COMPARISON", margin + 8, yPosition + 8);
Â  Â  yPosition += 20;

Â  Â  // Create bar chart
Â  Â  const chartWidth = contentWidth;
Â  Â  const chartHeight = 80;
Â  Â  const chartX = margin;
Â  Â  const chartY = yPosition;
Â  Â  const barSpacing = 15; // Increased spacing
Â  Â  const barWidth = (chartWidth - (scores.length + 1) * barSpacing) / scores.length;
Â  Â  const maxScore = 100;

Â  Â  // Chart background
Â  Â  pdf.setFillColor(...lightColor);
Â  Â  pdf.rect(chartX, chartY, chartWidth, chartHeight, "F");
Â  Â  pdf.setDrawColor(226, 232, 240);
Â  Â  pdf.rect(chartX, chartY, chartWidth, chartHeight, "D");

Â  Â  // Y-axis labels
Â  Â  pdf.setTextColor(100, 100, 100);
Â  Â  pdf.setFontSize(8);
Â  Â  for (let i = 0; i <= 5; i++) {
Â  Â  Â  const score = i * 20;
Â  Â  Â  const y = chartY + chartHeight - (score / maxScore) * chartHeight;
Â  Â  Â  pdf.text(score.toString(), chartX - 5, y, { align: "right" });
Â  Â  Â  pdf.setDrawColor(240, 240, 240);
Â  Â  Â  pdf.line(chartX, y, chartX + chartWidth, y);
Â  Â  }

Â  Â  // Bars
Â  Â  scores.forEach((item, index) => {
Â  Â  Â  const barX = chartX + barSpacing + (index * (barWidth + barSpacing));
Â  Â  Â  const barHeight = (item.score / maxScore) * (chartHeight - 20);
Â  Â  Â  const barY = chartY + chartHeight - barHeight;

Â  Â  Â  pdf.setFillColor(...item.color);
Â  Â  Â  pdf.rect(barX, barY, barWidth, barHeight, "F");

Â  Â  Â  // Score label
Â  Â  Â  pdf.setTextColor(...darkColor);
Â  Â  Â  pdf.setFontSize(9);
Â  Â  Â  pdf.setFont("helvetica", "bold");
Â  Â  Â  pdf.text(item.score.toString(), barX + (barWidth / 2), barY - 5, { align: "center" });

Â  Â  Â  // Category label
Â  Â  Â  pdf.setFontSize(8);
Â  Â  Â  pdf.setFont("helvetica", "normal");
Â  Â  Â  pdf.text(item.label, barX + (barWidth / 2), chartY + chartHeight + 5, { align: "center" });
Â  Â  });

Â  Â  yPosition += chartHeight + 25;

Â  Â  /** -------------------------------- DETAILED ANALYSIS -------------------------------- **/
Â  Â  if (report.analysis) {
Â  Â  Â  if (yPosition > pageHeight - 50) {
Â  Â  Â  Â  pdf.addPage();
Â  Â  Â  Â  yPosition = margin;
Â  Â  Â  }

Â  Â  Â  pdf.setFillColor(...primaryColor);
Â  Â  Â  pdf.rect(margin, yPosition, contentWidth, 12, "F");
Â  Â  Â  pdf.setTextColor(255, 255, 255);
Â  Â  Â  pdf.setFontSize(16);
Â  Â  Â  pdf.text("DETAILED ANALYSIS", margin + 8, yPosition + 8);
Â  Â  Â  yPosition += 20;

Â  Â  Â  // Clean and format analysis text
Â  Â  Â  const cleanAnalysis = cleanAnalysisText(report.analysis);
Â  Â  Â  const analysisLines = cleanAnalysis.split('\n').filter(line => line.trim() !== '');

Â  Â  Â  analysisLines.forEach((line: string) => {
Â  Â  Â  Â  const textLines = pdf.splitTextToSize(line, contentWidth);

Â  Â  Â  Â  textLines.forEach((textLine: string) => {
Â  Â  Â  Â  Â  if (yPosition > pageHeight - 15) {
Â  Â  Â  Â  Â  Â  pdf.addPage();
Â  Â  Â  Â  Â  Â  yPosition = margin;
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  Â  pdf.setTextColor(...darkColor);
Â  Â  Â  Â  Â  pdf.setFontSize(10);
Â  Â  Â  Â  Â  pdf.setFont("helvetica", "normal");
Â  Â  Â  Â  
Â  Â  Â  Â  Â  // Check for a new section header
Â  Â  Â  Â  Â  if (textLine.match(/^\d+\.\s/)) {
Â  Â  Â  Â  Â  Â  yPosition += 6;
Â  Â  Â  Â  Â  Â  pdf.setFont("helvetica", "bold");
Â  Â  Â  Â  Â  Â  pdf.setTextColor(...primaryColor);
Â  Â  Â  Â  Â  Â  pdf.text(textLine, margin, yPosition);
Â  Â  Â  Â  Â  Â  yPosition += 6;
Â  Â  Â  Â  Â  Â  pdf.setFont("helvetica", "normal");
Â  Â  Â  Â  Â  Â  pdf.setTextColor(...darkColor);
Â  Â  Â  Â  Â  } else if (textLine.match(/^(Recommendation|Plain English Explanation|Impact|Action Steps|Assessment|Current Backlink Count):/)) {
Â  Â  Â  Â  Â  Â  yPosition += 4;
Â  Â  Â  Â  Â  Â  pdf.setFont("helvetica", "bold");
Â  Â  Â  Â  Â  Â  pdf.setTextColor(...darkColor);
Â  Â  Â  Â  Â  Â  pdf.text(textLine, margin, yPosition);
Â  Â  Â  Â  Â  Â  yPosition += 5;
Â  Â  Â  Â  Â  Â  pdf.setFont("helvetica", "normal");
Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  pdf.text(`â€¢ ${textLine}`, margin, yPosition);
Â  Â  Â  Â  Â  Â  yPosition += 5;
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });
Â  Â  Â  });
Â  Â  Â  
Â  Â  Â  yPosition += 10;
Â  Â  }

Â  Â  /** -------------------------------- RECOMMENDATIONS TABLE -------------------------------- **/
Â  Â  if (report.recommendations && report.recommendations.length > 0) {
Â  Â  Â  if (yPosition > pageHeight - 50) {
Â  Â  Â  Â  pdf.addPage();
Â  Â  Â  Â  yPosition = margin;
Â  Â  Â  }

Â  Â  Â  pdf.setFillColor(...primaryColor);
Â  Â  Â  pdf.rect(margin, yPosition, contentWidth, 12, "F");
Â  Â  Â  pdf.setTextColor(255, 255, 255);
Â  Â  Â  pdf.setFontSize(16);
Â  Â  Â  pdf.text("RECOMMENDATIONS", margin + 8, yPosition + 8);
Â  Â  Â  yPosition += 20;

Â  Â  Â  // Prepare table data
Â  Â  Â  const tableData = report.recommendations.map((rec, index) => [
Â  Â  Â  Â  (index + 1).toString(),
Â  Â  Â  Â  rec.text,
Â  Â  Â  Â  rec.priority
Â  Â  Â  ]);

Â  Â  Â  autoTable(pdf, {
Â  Â  Â  Â  startY: yPosition,
Â  Â  Â  Â  head: [['#', 'Recommendation', 'Priority']],
Â  Â  Â  Â  body: tableData,
Â  Â  Â  Â  theme: 'grid',
Â  Â  Â  Â  headStyles: {
Â  Â  Â  Â  Â  fillColor: primaryColor,
Â  Â  Â  Â  Â  textColor: 255,
Â  Â  Â  Â  Â  fontStyle: 'bold'
Â  Â  Â  Â  },
Â  Â  Â  Â  bodyStyles: {
Â  Â  Â  Â  Â  textColor: darkColor,
Â  Â  Â  Â  Â  fontSize: 9
Â  Â  Â  Â  },
Â  Â  Â  Â  columnStyles: {
Â  Â  Â  Â  Â  0: { cellWidth: 15, halign: 'center' },
Â  Â  Â  Â  Â  2: { cellWidth: 25, halign: 'center' }
Â  Â  Â  Â  },
Â  Â  Â  Â  styles: {
Â  Â  Â  Â  Â  cellPadding: 3,
Â  Â  Â  Â  Â  fontSize: 9
Â  Â  Â  Â  },
Â  Â  Â  Â  didDrawCell: (data) => {
Â  Â  Â  Â  Â  if (data.section === 'body' && data.column.index === 2) {
Â  Â  Â  Â  Â  Â  const priority = data.cell.raw as string;
Â  Â  Â  Â  Â  Â  let color: number[] = darkColor;
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  if (priority === 'High') color = dangerColor;
Â  Â  Â  Â  Â  Â  else if (priority === 'Medium') color = warningColor;
Â  Â  Â  Â  Â  Â  else if (priority === 'Low') color = successColor;
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  pdf.setTextColor(...color);
Â  Â  Â  Â  Â  Â  pdf.setFont("helvetica", "bold");
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  });

Â  Â  Â  yPosition = (pdf as any).lastAutoTable.finalY + 10;
Â  Â  }

Â  Â  /** -------------------------------- PRIORITY BREAKDOWN -------------------------------- **/
// Â  Â  if (report.recommendations && report.recommendations.length > 0) {
// Â  Â  Â  if (yPosition > pageHeight - 50) {
// Â  Â  Â  Â  pdf.addPage();
// Â  Â  Â  Â  yPosition = margin;
// Â  Â  Â  }

// Â  Â  Â  pdf.setFillColor(...primaryColor);
// Â  Â  Â  pdf.rect(margin, yPosition, contentWidth, 12, "F");
// Â  Â  Â  pdf.setTextColor(255, 255, 255);
// Â  Â  Â  pdf.setFontSize(16);
// Â  Â  Â  pdf.text("PRIORITY BREAKDOWN", margin + 8, yPosition + 8);
// Â  Â  Â  yPosition += 20;

// Â  Â  Â  const priorityCounts = {
// Â  Â  Â  Â  High: report.recommendations.filter(r => r.priority === 'High').length,
// Â  Â  Â  Â  Medium: report.recommendations.filter(r => r.priority === 'Medium').length,
// Â  Â  Â  Â  Low: report.recommendations.filter(r => r.priority === 'Low').length
// Â  Â  Â  };

// Â  Â  Â  const total = report.recommendations.length;
// Â  Â  Â  const chartRadius = 30;
// Â  Â  Â  const chartCenterX = margin + contentWidth / 2;
// Â  Â  Â  const chartCenterY = yPosition + 50;

// Â  Â  Â  // Draw pie chart
// Â  Â  Â  let startAngle = 0;
// Â  Â  Â  const priorities = [
// Â  Â  Â  Â  { priority: 'High', color: dangerColor, count: priorityCounts.High },
// Â  Â  Â  Â  { priority: 'Medium', color: warningColor, count: priorityCounts.Medium },
// Â  Â  Â  Â  { priority: 'Low', color: successColor, count: priorityCounts.Low }
// Â  Â  Â  ];

// Â  Â  Â  priorities.forEach(item => {
// Â  Â  Â  Â  if (item.count > 0) {
// Â  Â  Â  Â  Â  const angle = (item.count / total) * 360;
// Â  Â  Â  Â  Â  pdf.setFillColor(...item.color);
// Â  Â  Â  Â  Â // Draw pie chart manually with paths
// let startAngle = 0;
// const radius = chartRadius;

// priorities.forEach(item => {
// Â  if (item.count > 0) {
// Â  Â  const sliceAngle = (item.count / total) * 2 * Math.PI; // in radians
// Â  Â  const endAngle = startAngle + sliceAngle;

// Â  Â  // Convert polar to cartesian
// Â  Â  const x1 = chartCenterX + radius * Math.cos(startAngle);
// Â  Â  const y1 = chartCenterY + radius * Math.sin(startAngle);
// Â  Â  const x2 = chartCenterX + radius * Math.cos(endAngle);
// Â  Â  const y2 = chartCenterY + radius * Math.sin(endAngle);

// Â  Â  pdf.setFillColor(...item.color);

// Â  Â  // Start path
// Â  Â  pdf.lines(
// Â  Â  Â  [
// Â  Â  Â  Â  [x1 - chartCenterX, y1 - chartCenterY],
// Â  Â  Â  Â  [x2 - x1, y2 - y1],
// Â  Â  Â  Â  [chartCenterX - x2, chartCenterY - y2]
// Â  Â  Â  ],
// Â  Â  Â  chartCenterX,
// Â  Â  Â  chartCenterY,
// Â  Â  Â  [1, 1],
// Â  Â  Â  'F'
// Â  Â  );

// Â  Â  startAngle = endAngle;
// Â  }
// });

// Â  Â  Â  Â  Â  startAngle += angle;
// Â  Â  Â  Â  }
// Â  Â  Â  });

// Â  Â  Â  // Legend
// Â  Â  Â  const legendX = margin;
// Â  Â  Â  const legendY = yPosition + 100;
// Â  Â  Â  
// Â  Â  Â  priorities.forEach((item, index) => {
// Â  Â  Â  Â  if (item.count > 0) {
// Â  Â  Â  Â  Â  const y = legendY + (index * 15);
// Â  Â  Â  Â  Â  
// Â  Â  Â  Â  Â  pdf.setFillColor(...item.color);
// Â  Â  Â  Â  Â  pdf.rect(legendX, y, 8, 8, 'F');
// Â  Â  Â  Â  Â  
// Â  Â  Â  Â  Â  pdf.setTextColor(...darkColor);
// Â  Â  Â  Â  Â  pdf.setFontSize(9);
// Â  Â  Â  Â  Â  pdf.text(`${item.priority}: ${item.count} recommendations (${Math.round((item.count / total) * 100)}%)`, legendX + 12, y + 6);
// Â  Â  Â  Â  }
// Â  Â  Â  });

// Â  Â  Â  yPosition += 120;
// Â  Â  }

Â  Â  /** -------------------------------- FOOTER -------------------------------- **/
Â  Â  const totalPages = pdf.getNumberOfPages();
Â  Â  for (let i = 1; i <= totalPages; i++) {
Â  Â  Â  pdf.setPage(i);
Â  Â  Â  
Â  Â  Â  // Page number
Â  Â  Â  pdf.setFontSize(10);
Â  Â  Â  pdf.setTextColor(150, 150, 150);
Â  Â  Â  pdf.text(
Â  Â  Â  Â  `Page ${i} of ${totalPages}`,
Â  Â  Â  Â  pageWidth - margin,
Â  Â  Â  Â  pageHeight - 10,
Â  Â  Â  Â  { align: "right" }
Â  Â  Â  );

Â  Â  Â  // Confidential watermark for all pages except cover
Â  Â  Â  if (i > 1) {
Â  Â  Â  Â  pdf.setFontSize(8);
Â  Â  Â  Â  pdf.setTextColor(200, 200, 200);
Â  Â  Â  Â  pdf.text("CONFIDENTIAL - RANKSEO.IN", pageWidth / 2, pageHeight - 10, {
Â  Â  Â  Â  Â  align: "center",
Â  Â  Â  Â  });
Â  Â  Â  }

Â  Â  Â  // Border
Â  Â  Â  pdf.setDrawColor(226, 232, 240);
Â  Â  Â  pdf.rect(margin - 5, margin - 5, contentWidth + 10, pageHeight - margin * 2 + 10, "D");
Â  Â  }

Â  Â  /** -------------------------------- SAVE PDF -------------------------------- **/
Â  Â  pdf.save(
Â  Â  Â  `SEO-Audit-Report-${url.replace(/https?:\/\//, "").split("/")[0]}-${new Date().getTime()}.pdf`
Â  Â  );
Â  };

Â  // Helper function to clean analysis text
Â  const cleanAnalysisText = (text: string): string => {
Â  Â  return text
Â  Â  Â  .replace(/\*\*/g, '') // Remove **bold** markers
Â  Â  Â  .replace(/\*/g, '') Â  // Remove *italic* markers
Â  Â  Â  .replace(/^\s*â€¢\s*/gm, '') // Remove bullet points at the start of lines
Â  Â  Â  .replace(/^\d+\.\s/gm, '\n$&') // Add a newline before numbered lists to create new lines
Â  Â  Â  .replace(/#{1,6}\s/g, '') // Remove headers
Â  Â  Â  .replace(/---+/g, '') // Remove horizontal lines
Â  Â  Â  .replace(/\n\s*\n\s*\n/g, '\n\n') // Remove excessive newlines
Â  Â  Â  .replace(/([A-Z][A-Za-z\s]+):/g, '\n$1:\n') // Format section headers
Â  Â  Â  .trim();
Â  };

Â  return (
Â  Â  <button
Â  Â  Â  onClick={handleDownloadPDF}
Â  Â  Â  className="px-4 sm:px-6 py-2 bg-teal-600 text-white rounded-lg hover:bg-teal-700 transition-colors flex items-center gap-2 text-sm sm:text-base shadow-lg"
Â  Â  >
Â  Â  Â  <DownloadIcon />
Â  Â  Â  Download PDF Report
Â  Â  </button>
Â  );
};

// Download icon component
const DownloadIcon = () => (
Â  <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
Â  Â  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
Â  </svg>
);

export default PDFGenerator;